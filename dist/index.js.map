{"version":3,"file":"index.js","sources":["../src/config/index.js","../src/models/user.js","../src/models/employee.js","../src/config/passport.js","../src/models/like.js","../src/models/comment.js","../src/middleware/access.js","../src/middleware/checkId.js","../src/resources/defaultRoutes.js","../src/routes/users.js","../src/models/dish.js","../src/resources/ifModifiedSince.js","../src/resources/getLastModified.js","../src/resources/testDefaultRoutes.js","../src/routes/dishes.js","../src/models/location.js","../src/routes/locations.js","../src/routes/likes.js","../src/routes/comments.js","../src/models/topping.js","../src/routes/toppings.js","../src/helpers/getUniqueNumber.js","../src/models/order.js","../src/routes/orders.js","../src/routes/employees.js","../src/models/shedule.js","../src/routes/shedules.js","../src/index.js"],"sourcesContent":["export default {\r\n\tdatabase: 'mongodb://sm1t:34ezezin@ds145299.mlab.com:45299/food72',\r\n\tsecret: 'yoursecret'\r\n}","import mongoose from 'mongoose';\r\nimport bcrypt from 'bcryptjs';\r\nimport Promise from 'bluebird';\r\nimport _ from 'lodash';\r\nmongoose.Promise = Promise;\r\n\r\nconst UserSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tphone: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\temail: {\r\n\t\ttype: String\r\n\t},\r\n\tavatar: {\r\n\t\ttype: String,\r\n\t\tdefault: ''\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\n\r\nUserSchema.methods.toJSON = function() {\r\n\treturn _.pick(this, ['_id', 'name', 'phone', 'email', 'avatar']);\r\n}\r\n\r\nUserSchema.pre('save', function(next) {\r\n\treturn bcrypt.genSalt(10)\r\n\t.then(salt => {\r\n\t\tbcrypt.hash(this.password, salt)\r\n\t\t.then(hash => {\r\n\t\t\tthis.password = hash;\r\n\t\t\tnext();\r\n\t\t})\r\n\t})\r\n\t.catch(next)\r\n})\r\n\r\nexport default mongoose.model('User', UserSchema);\r\n\r\n\r\n","import mongoose from 'mongoose';\r\nimport _ from 'lodash';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nconst EmployeeSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tsurname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tposition: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tlogin: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\trole: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\tdefault: 'employee'\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\n\r\nEmployeeSchema.methods.toJSON = function() {\r\n\treturn _.pick(this, ['_id', 'name', 'surname', 'position']);\r\n}\r\n\r\nEmployeeSchema.pre('save', function(next) {\r\n\treturn bcrypt.genSalt(10)\r\n\t.then(salt => {\r\n\t\tbcrypt.hash(this.password, salt)\r\n\t\t.then(hash => {\r\n\t\t\tthis.password = hash;\r\n\t\t\tnext();\r\n\t\t})\r\n\t})\r\n\t.catch(next)\r\n})\r\n\r\nexport default mongoose.model('Employee', EmployeeSchema);\r\n\r\n\r\n","const JwtStrategy = require('passport-jwt').Strategy;\r\nconst ExtractJwt = require('passport-jwt').ExtractJwt;\r\nimport User from '../models/user';\r\nimport Employee from '../models/employee';\r\nimport config from '../config/index';\r\n\r\nexport default async function Passport(passport){\r\n\tlet opts = {};\r\n\topts.jwtFromRequest = ExtractJwt.fromAuthHeader();\r\n\topts.secretOrKey = config.secret;\r\n\tpassport.use(new JwtStrategy(opts, async (jwt_payload, done) => {\r\n\t\ttry {\r\n\t\t\tif (jwt_payload.login) {\r\n\t\t\t\tvar user = await Employee.findOne({login: jwt_payload.login});\r\n\t\t\t}\r\n\t\t\tif (jwt_payload.phone) {\r\n\t\t\t\tvar user = await User.findOne({phone: jwt_payload.phone});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//console.log(user);\r\n\t\t\tif (user) {\r\n\t\t\t\treturn done(null, user);\r\n\t\t\t} else done(null, false);\r\n\t\t} catch(err) {\r\n\t\t\treturn done(err, false);\r\n\t\t}\r\n\t}))\r\n}","import mongoose from 'mongoose';\r\nimport _ from 'lodash';\r\nconst { Schema } = mongoose;\r\n\r\nconst LikeSchema = mongoose.Schema({\r\n\tdishId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'Dish',\r\n\t\trequired: true\r\n\t},\r\n\tuserId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'Dish',\r\n\t\trequired: true\r\n\t},\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\nLikeSchema.methods.toJSON = function() {\r\n\treturn _.pick(this, ['dishId', 'userId']);\r\n}\r\n\r\nexport default mongoose.model('Like', LikeSchema);\r\n\r\n","import mongoose from 'mongoose';\r\nimport { Schema } from 'mongoose';\r\n\r\nconst CommentSchema = mongoose.Schema({\r\n\tdish: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'Dish',\r\n\t\trequired: true\r\n\t},\r\n\tuserId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'User',\r\n\t\trequired: true\r\n\t},\r\n\ttext: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\trating: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n})\r\n\r\nexport default mongoose.model('Comment', CommentSchema);","export default (req, res, next) => {\r\n\tconst userAccess = ['/likes', '/comments', '/orders'];\r\n\tconst employeeAccess = ['/dishes', '/toppings', '/locations', '/menu', '/shedules'];\r\n\tconst adminAccess = ['/employees'];\r\n\r\n\tif (req.user) {\r\n\t\tif (adminAccess.indexOf(req.originalUrl) != -1) {\r\n\t\t\tif (req.user.role === 'admin') return next();\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Access denied'});\r\n\t\t}\r\n\r\n\t\tif (employeeAccess.indexOf(req.originalUrl) != -1) {\r\n\t\t\tif (req.user.login) return next();\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Access denied'});;\r\n\t\t}\r\n\r\n\t\tif (userAccess.indexOf(req.originalUrl) != -1) {\r\n\t\t\tif (req.user.phone) return next();\r\n\t\t\treturn res.status(401).json({success: false, msg: 'Unauthorized'});;\r\n\t\t}\r\n\t}\r\n\r\n\treturn res.status(403).json({success: false, msg: 'Access denied'});\r\n}","export default (req, res, next) => {\r\n\tconst id = req.params.id;\r\n\tif (!id) return next();\r\n\tconst re = new RegExp('(^[0-9a-fA-F]{24}$)');\r\n\tif (!id.match(re)) {\r\n\t\treturn res.status(400).json({success: false, msg: `Incorrect id`});\r\n\t}\r\n\treturn next();\r\n}","import express from 'express';\r\nimport passport from 'passport';\r\nimport access from '../middleware/access';\r\nimport checkId from '../middleware/checkId';\r\n\r\nexport default class defaultRoutes {\r\n\tconstructor() {\r\n\t\tthis.router = express.Router();\r\n\t}\r\n\r\n\tinit(model, modelName) {\r\n\t\tthis.initGet(model, modelName);\r\n\t\tthis.initPost(model, modelName);\r\n\t\tthis.initChange(model, modelName);\r\n\t\tthis.initDelete(model, modelName);\r\n\t}\r\n\t\r\n\tinitGet(model, modelName) {\r\n\t\tthis.router.get('/:id?/:select?', passport.authenticate('jwt', {session: false}), access, async(req, res) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\tconst select = req.params.select;\r\n\r\n\t\t\tif (!id && !select) {\r\n\t\t\t\tlet modifiedSince = req.headers['if-modified-since'];\r\n\t\t\t\tif (modifiedSince) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tmodifiedSince = new Date(Date.parse(modifiedSince));\r\n\t\t\t\t\t\tlet news = await model.find({\"updatedAt\": {$gt: modifiedSince}});\r\n\t\t\t\t\t\tif (news[0]) {\r\n\t\t\t\t\t\t\tlet lastModified = news.reduce(function(prev, candidate) {\r\n\t\t\t\t\t\t\t\treturn (prev.updatedAt > candidate.updatedAt) ? prev : candidate;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tlastModified = Date.parse(lastModified.updatedAt);\r\n\t\t\t\t\t\t\tconst opts = {\r\n\t\t\t\t\t\t\t\tyear: 'numeric',\r\n\t\t\t\t\t\t\t\tmonth: 'short',\r\n\t\t\t\t\t\t\t\tday: 'numeric',\r\n\t\t\t\t\t\t\t\tweekday: 'short',\r\n\t\t\t\t\t\t\t\thour: 'numeric',\r\n\t\t\t\t\t\t\t\tminute: 'numeric',\r\n\t\t\t\t\t\t\t\tsecond: 'numeric',\r\n\t\t\t\t\t\t\t\ttimeZoneName: 'short',\r\n\t\t\t\t\t\t\t\thour12: false\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tlastModified = (new Date(lastModified)).toLocaleString('en-US', opts);\r\n\t\t\t\t\t\t\tres.set('Last-Modified', lastModified);\r\n\t\t\t\t\t\t\treturn res.json(news);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn res.status(304).send();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(err) {\r\n\t\t\t\t\t\tnext(err);\t\r\n\t\t\t\t\t}\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (req.user.phone) {\r\n\t\t\t\t\t\treturn res.json(await model.find({userId: req.user._id}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn res.json(await model.find());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst re = new RegExp('(^[0-9a-fA-F]{24}$)');\r\n\t\t\tif (!id.match(re)) {\r\n\t\t\t\treturn res.status(400).json({success: false, msg: `Incorrect ${modelName} id`})\r\n\t\t\t}\r\n\r\n\t\t\tif (id && !select) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\t\tif (!elem) return res.status(404).json({success: false, msg: `${modelName} not found`})\r\n\t\t\t\t\treturn res.json(elem);\r\n\t\t\t\t} catch(err) {\r\n\t\t\t\t\tnext(err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem[`${select}`]) return res.json({success: false, msg: `Cannot select ${select}`});\r\n\t\t\t\treturn res.json(elem[`${select}`]);\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitPost(model, modelName) {\r\n\t\tthis.router.post('', passport.authenticate('jwt', {session: false}), access, async(req, res) => {\r\n\t\t\ttry {\r\n\t\t\t\t/*if (['orders', 'likes', 'comments'].indexOf(modelName) != -1) {\r\n\t\t\t\t\tvar elem = new model(Object.assign({}, req.body, {userId: req.user.id}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar elem = new model(req.body);\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\tconst elem = new model(req.body);\r\n\t\t\t\tawait elem.save();\r\n\t\t\t\treturn res.status(201).json(elem);\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitChange(model, modelNmae) {\r\n\t\tthis.router.post('/:id', checkId, passport.authenticate('jwt', {session: false}), access, async(req, res) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst id = req.params.id;\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem) return res.status(404).json({success:false, msg: `${modelName} not found`});\r\n\t\t\t\tawait model.update({_id: id}, {$set:\r\n\t\t\t\t\treq.body\r\n\t\t\t\t});\r\n\t\t\t\treturn res.json({success: true, msg: `${modelName} updated`});\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitDelete(model, modelName) {\r\n\t\tthis.router.delete('/:id', checkId, passport.authenticate('jwt', {session: false}), access, async(req, res) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem) return res.status(404).json({success:false, msg: `${modelName} not found`});\r\n\t\t\t\tawait elem.remove();\r\n\t\t\t\treturn res.json({success: true, msg: `${modelName} deleted`});\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n\r\n","import passport from 'passport';\r\nimport jwt from 'jsonwebtoken';\r\nimport config from '../config/index';\r\nimport bcrypt from 'bcryptjs';\r\nimport User from '../models/user';\r\nimport Like from '../models/like';\r\nimport Comment from '../models/comment';\r\nimport defaultRoutes from '../resources/defaultRoutes';\r\n\r\nconst defaultUsers = new defaultRoutes();\r\n\r\n// Register\r\ndefaultUsers.router.post('', async(req, res) => {\r\n\tconst exist = await User.findOne({phone: req.body.phone});\r\n\tif (exist) return res.status(400).json({success: false, msg: 'User already exist'});\r\n\r\n\ttry {\r\n\t\tconst user = new User(req.body),\r\n\t\t\t  phone = user.phone;\r\n\t\tuser.save();\r\n\t\tconst token = jwt.sign({phone}, config.secret, {expiresIn: 604800});\r\n\t\treturn res.status(201).json(Object.assign({}, user.toJSON(), {token: 'JWT ' + token}));\r\n\t} catch(err) {\r\n\t\tconsole.log(err);\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n});\r\n\r\n// login\r\ndefaultUsers.router.post('/login', async(req, res) => {\r\n\tconst phone = req.body.phone,\r\n\t\t  password = req.body.password;\r\n\r\n\tconst user = await User.findOne({phone: phone});\r\n\tif (!user) return res.status(404).json({success: false, msg: \"User not found\"});\r\n\r\n\ttry {\r\n\t\tif (await bcrypt.compare(password, user.password)) {\r\n\t\t\tconst token = jwt.sign({phone}, config.secret, {expiresIn: 604800});\r\n\t\t\treturn res.json(Object.assign({}, user.toJSON(), {token: 'JWT ' + token}));\r\n\t\t} else {\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Wrong password'});\r\n\t\t}\r\n\t} catch(err) {\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n})\r\n\r\ndefaultUsers.router.post('/profile', passport.authenticate('jwt', {session: false}), async (req, res) => {\r\n\tres.json(['/dishes', 'toppings', '/locations'].indexOf(req.path));\r\n})\r\n\r\ndefaultUsers.init(User, 'user');\r\n\r\nexport default defaultUsers.router;\r\n\r\n","import mongoose from 'mongoose';\r\nimport Like from './like';\r\nimport { Schema } from 'mongoose';\r\nimport _ from 'lodash';\r\n\r\n// Product Schema\r\nconst DishSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tcategory : {\r\n\t\ttype: String\r\n\t},\r\n\ttoppings: [\r\n\t\t{\r\n\t\t\ttoppingId: {\r\n\t\t\t\ttype: Schema.Types.ObjectId,\r\n\t\t\t\tref: 'Topping',\r\n\t\t\t\trequired: true\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tdishPicture: {\r\n\t\ttype: String\r\n\t},\r\n\tcallories: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tdescription: {\r\n\t\ttype: String\r\n\t},\r\n\tcomposition: [\r\n\t\t{\r\n\t\t\tname: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true\r\n\t\t\t},\r\n\t\t\tquantity: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tweight: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tconteiner: {\r\n\t\ttype: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\tsize: {\r\n\t\t\ttype: Number,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\tprice: {\r\n\t\t\ttype: Number,\r\n\t\t\trequired: true\r\n\t\t}\r\n\t},\r\n\tproteins: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tcarbohydrates: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tfats: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tprice: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\trating: {\r\n\t\ttype: Number,\r\n\t\tdefault: 5\r\n\t},\r\n\tlikes: {\r\n\t\ttype: Number,\r\n\t\trequired: true,\r\n\t\tdefault: 0\r\n\t},\r\n\tactive: {\r\n\t\ttype: Boolean,\r\n\t\tdefault: true,\r\n\t\trequired: true\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\nexport default mongoose.model('Dish', DishSchema);\r\n","export default async (model, modifiedSince) => {\r\n\tmodifiedSince = new Date(Date.parse(modifiedSince));\r\n\tlet news = await model.find({\"updatedAt\": {$gt: modifiedSince}});\r\n\tif (news[0]) {\r\n\t\tlet lastModified = news.reduce(function(prev, candidate) {\r\n\t\t\treturn (prev.updatedAt > candidate.updatedAt) ? prev : candidate;\r\n\t\t});\r\n\t\tlastModified = Date.parse(lastModified.updatedAt);\r\n\t\tconst opts = {\r\n\t\t\tyear: 'numeric',\r\n\t\t\tmonth: 'short',\r\n\t\t\tday: 'numeric',\r\n\t\t\tweekday: 'short',\r\n\t\t\thour: 'numeric',\r\n\t\t\tminute: 'numeric',\r\n\t\t\tsecond: 'numeric',\r\n\t\t\ttimeZoneName: 'short',\r\n\t\t\thour12: false\r\n\t\t};\r\n\t\tlastModified = (new Date(lastModified)).toLocaleString('en-US', opts);\r\n\t\treturn {\r\n\t\t\tnews,\r\n\t\t\tlastModified\r\n\t\t}\r\n\t} else {\r\n\t\treturn;\r\n\t}\r\n}","export default async (model) => {\r\n\tconst arr = await model.find();\r\n\tlet lastModified = arr.reduce(function(prev, candidate) {\r\n\t\treturn (prev.updatedAt > candidate.updatedAt) ? prev : candidate;\r\n\t});\r\n\tlastModified = Date.parse(lastModified.updatedAt);\r\n\tconst opts = {\r\n\t\tyear: 'numeric',\r\n\t\tmonth: 'short',\r\n\t\tday: 'numeric',\r\n\t\tweekday: 'short',\r\n\t\thour: 'numeric',\r\n\t\tminute: 'numeric',\r\n\t\tsecond: 'numeric',\r\n\t\ttimeZoneName: 'short',\r\n\t\thour12: false\r\n\t};\r\n\tlastModified = (new Date(lastModified)).toLocaleString('en-US', opts);\r\n\treturn lastModified;\r\n}","import express from 'express';\r\nimport access from '../middleware/access';\r\nimport checkId from '../middleware/checkId';\r\nimport ifModifiedSince from '../resources/ifModifiedSince';\r\nimport getLastModified from '../resources/getLastModified';\r\n\r\nexport default class defaultRoutes {\r\n\tconstructor(params) {\r\n\t\tObject.assign(this, params);\r\n\t\tthis.router = express.Router();\r\n\t}\r\n\r\n\tinit(model, modelName) {\r\n\t\tthis.initGet(model, modelName);\r\n\t\tthis.initPost(model, modelName);\r\n\t\tthis.initPut(model, modelName);\r\n\t\tthis.initDelete(model, modelName);\r\n\t}\r\n\t\r\n\tinitGet(model, modelName) {\r\n\t\tthis.router.get('/:id?/:select?', checkId, this.getMiddlewares || [], async(req, res, next) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\tconst select = req.params.select;\r\n\r\n\t\t\tif (!id && !select) {\r\n\t\t\t\tlet modifiedSince = req.headers['if-modified-since'];\r\n\t\t\t\tif (modifiedSince) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst changes = await ifModifiedSince(model, modifiedSince);\r\n\t\t\t\t\t\tif (changes) {\r\n\t\t\t\t\t\t\tres.set('Last-Modified', changes.lastModified);\r\n\t\t\t\t\t\t\treturn res.json(changes.news);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn res.status(304).send();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(err) {\r\n\t\t\t\t\t\tnext(err);\t\r\n\t\t\t\t\t}\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (req.user && req.user.phone) {\r\n\t\t\t\t\t\treturn res.json(await model.find({userId: req.user._id}));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst lastModified = await getLastModified(model);\r\n\t\t\t\t\tres.set('Last-Modified', lastModified);\r\n\t\t\t\t\treturn res.json(await model.find());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst re = new RegExp('(^[0-9a-fA-F]{24}$)');\r\n\t\t\tif (!id.match(re)) {\r\n\t\t\t\treturn res.status(400).json({success: false, msg: `Incorrect ${modelName} id`})\r\n\t\t\t}\r\n\r\n\t\t\tif (id && !select) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\t\tif (!elem) return res.status(404).json({success: false, msg: `${modelName} not found`})\r\n\t\t\t\t\treturn res.json(elem);\r\n\t\t\t\t} catch(err) {\r\n\t\t\t\t\tnext(err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem[`${select}`]) return res.json({success: false, msg: `Cannot select ${select}`});\r\n\t\t\t\treturn res.json(elem[`${select}`]);\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitPost(model, modelName) {\r\n\t\tthis.router.post('', this.postMiddlewares || [], async(req, res, next) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst exist = await model.findOne(req.body);\r\n\t\t\t\tif (exist) {\r\n\t\t\t\t\treturn res.status(400).json({success: false, msg: `${modelName} aready exist`});\r\n\t\t\t\t}\r\n\t\t\t\tconst elem = new model(req.body);\r\n\t\t\t\tawait elem.save();\r\n\t\t\t\treturn res.status(201).json(elem);\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitPut(model, modelName) {\r\n\t\tthis.router.put('/:id', checkId, this.putMiddlewares || [], async(req, res, next) => {\r\n\t\t\tconst id = req.params.id;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem) return res.status(404).json({success:false, msg: `${modelName} not found`});\r\n\t\t\t\tawait model.update({_id: id}, {$set:\r\n\t\t\t\t\treq.body\r\n\t\t\t\t});\r\n\t\t\t\treturn res.json({success: true, msg: `${modelName} updated`});\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitDelete(model, modelName) {\r\n\t\tthis.router.delete('/:id', checkId, this.deleteMiddlewares || [], async(req, res, next) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem) return res.status(404).json({success:false, msg: `${modelName} not found`});\r\n\t\t\t\tawait elem.remove();\r\n\t\t\t\treturn res.json({success: true, msg: `${modelName} deleted`});\r\n\t\t\t} catch(err) {\r\n\t\t\t\tnext(err);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n\r\n","import Dish from '../models/dish';\r\nimport testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport ifModifiedSince from '../resources/ifModifiedSince';\r\n\r\nconst defaultDishes = new testDefaultRoutes();\r\n\r\ndefaultDishes.init(Dish, 'dish');\r\n\r\nexport default defaultDishes.router;","import mongoose from 'mongoose';\r\nconst { Schema } = mongoose;\r\n\r\nconst LocationSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tnumber: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tworkTime: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'Shedule',\r\n\t\trequired: true\r\n\t}\r\n})\r\n\r\nexport default mongoose.model('Location', LocationSchema);","import testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport Location from '../models/location';\r\n\r\n\r\nconst defaultLocations = new testDefaultRoutes();\r\ndefaultLocations.init(Location, 'locations');\r\n\r\nexport default defaultLocations.router;","import testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport Like from '../models/like';\r\nimport Dish from '../models/dish';\r\nimport checkId from '../middleware/checkId';\r\nimport passport from 'passport';\r\n\r\nconst defaultLikes = new testDefaultRoutes();\r\n\r\ndefaultLikes.router.post('', passport.authenticate('jwt', {session: false}), async(req, res, next) => {\r\n\ttry {\r\n\t\tconst exist = await Like.findOne({dishId: req.body.dishId, userId: req.user._id});\r\n\t\tif (exist) {\r\n\t\t\tawait exist.remove();\r\n\t\t\tawait Dish.update({_id: exist.dishId, $isolated: true}, {$inc:\r\n\t\t\t\t{\r\n\t\t\t\t\tlikes: -1,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\treturn res.json({success: true, msg: 'Like deleted'});\r\n\t\t}\r\n\t\tconst newLike = new Like(Object.assign({}, req.body, {userId: req.user._id}));\r\n\t\tawait newLike.save();\r\n\t\tawait Dish.update({_id: newLike.dishId, $isolated: true}, {$inc:\r\n\t\t\t{\r\n\t\t\t\tlikes: 1\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res.status(201).json(newLike);\r\n\t} catch(err) {\r\n\t\tnext(err);\r\n\t}\r\n})\r\n\r\ndefaultLikes.initGet(Like, 'like');\r\n\r\nexport default defaultLikes.router;\r\n","import testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport Comment from '../models/comment';\r\n\r\nconst defaultComments = new testDefaultRoutes();\r\ndefaultComments.init(Comment, 'comments');\r\n\r\nexport default defaultComments.router;","import mongoose from 'mongoose';\r\nimport { Schema } from 'mongoose';\r\n\r\nconst ToppingSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tprice: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tweight: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t}\r\n})\r\n\r\nexport default mongoose.model('Topping', ToppingSchema);","import testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport Topping from '../models/topping';\r\n\r\nconst defaultToppings = new testDefaultRoutes();\r\ndefaultToppings.init(Topping, 'topping');\r\n\r\nexport default defaultToppings.router;","import Order from '../models/order';\r\n\r\nexport default async () => {\r\n\tconst arr = [...Array(10).keys()].splice(1);\r\n\tconst orders = await Order.find();\r\n\tconst usedNumbers = [];\r\n\torders.map(order => {\r\n\t\tusedNumbers.push(order.number);\r\n\t})\r\n\tconst unique = arr.filter((value) => {\r\n\t\treturn usedNumbers.indexOf(value) == -1;\r\n\t});\r\n\treturn unique[0];\r\n}","import mongoose from 'mongoose';\r\nimport getUniqueNumber from '../helpers/getUniqueNumber';\r\nconst { Schema } = mongoose;\r\n\r\nconst OrderSchema = mongoose.Schema({\r\n\t/*userId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'User',\r\n\t\trequired: true\r\n\t},*/\r\n\tdishes: [\r\n\t\t{\r\n\t\t\tdishId: {\r\n\t\t\t\ttype: Schema.Types.ObjectId,\r\n\t\t\t\tref: 'Dish',\r\n\t\t\t\trequired: true\r\n\t\t\t},\r\n\t\t\tquantity: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\trequired: true,\r\n\t\t\t\tdefault: 1\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tpayStatus: {\r\n\t\ttype: Boolean,\r\n\t\trequired: true,\r\n\t\tdefault: false\r\n\t},\r\n\tcompleted: {\r\n\t\ttype: Boolean,\r\n\t\trequired: true,\r\n\t\tdefault: false\r\n\t},\r\n\tstatus: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\tdefault: 'Обратывается'\r\n\t},\r\n\ttotalPrice: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\ttime: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tnumber: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\nOrderSchema.pre('save', function(next) {\r\n\treturn getUniqueNumber()\r\n\t.then(unique => {\r\n\t\tthis.number = unique;\r\n\t\tnext();\r\n\t})\r\n\t.catch(next)\r\n})\r\n\r\nexport default mongoose.model('Order', OrderSchema);","import testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport Order from '../models/order';\r\n\r\nconst defaultOrders = new testDefaultRoutes();\r\ndefaultOrders.init(Order, 'order');\r\n\r\nexport default defaultOrders.router;","import passport from 'passport';\r\nimport testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport Employee from '../models/employee';\r\nimport bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\nimport config from '../config/index';\r\n\r\nconst params = {\r\n\tgetMiddlewares:[], //middlewares for 'get' request\r\n\tpostMiddlewares:[], //middlewares for 'post' request\r\n\tdeleteMiddlewares:[], //middlewares for 'delete' request\r\n\tputMiddlewares:[] //middlewares for 'put' request\r\n}\r\n\r\nconst defaultEmployees = new testDefaultRoutes(params);\r\n\r\n// Register\r\ndefaultEmployees.router.post('', async(req, res) => {\r\n\tconst exist = await Employee.findOne({login: req.body.login});;\r\n\tif (exist) return res.status(400).json({success: false, msg: 'Employee already exist'});\r\n\r\n\ttry {\r\n\t\tconst employee = new Employee(req.body),\r\n\t\t\t  login = employee.login;\r\n\t\temployee.save();\r\n\t\tconst token = jwt.sign({login}, config.secret, {expiresIn: 604800});\r\n\t\treturn res.status(201).json(Object.assign({}, employee.toJSON(), {token: 'JWT ' + token}));\r\n\t} catch(err) {\r\n\t\tconsole.log(err);\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n});\r\n\r\n// Authenticate\r\ndefaultEmployees.router.post('/login', async(req, res) => {\r\n\tconst login = req.body.login,\r\n\t\t  password = req.body.password;\r\n\r\n\tconst employee = await Employee.findOne({login: login});\r\n\tif (!employee) return res.status(404).json({success: false, msg: \"Employee not found\"});\r\n\r\n\ttry {\r\n\t\tif (await bcrypt.compare(password, employee.password)) {\r\n\t\t\tconst token = jwt.sign({login}, config.secret, {expiresIn: 604800});\r\n\t\t\treturn res.json(Object.assign({}, employee.toJSON(), {token: 'JWT ' + token}));\r\n\t\t} else {\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Wrong password'});\r\n\t\t}\r\n\t} catch(err) {\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n})\r\n\r\ndefaultEmployees.router.post('/profile', passport.authenticate('jwt', {session: false}), async (req, res) => {\r\n\tres.json(req.user);\r\n})\r\n\r\n\r\ndefaultEmployees.initGet(Employee, 'employees');\r\ndefaultEmployees.initPut(Employee, 'employees');\r\n\r\nexport default defaultEmployees.router;","import mongoose from 'mongoose';\r\nconst { Schema } = mongoose;\r\n\r\nconst daySchema = new Schema({\r\n\tworkTime: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tbreak: [\r\n\t\t{\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t}\r\n\t]\r\n}, {\r\n\t_id: false\r\n})\r\n\r\n\r\n\r\nconst SheduleSchema = mongoose.Schema({\r\n\tmonday: daySchema,\r\n\ttuesday: daySchema,\r\n\twednesday: daySchema,\r\n\tthursday: daySchema,\r\n\tfriday: daySchema,\r\n\tsaturday: daySchema,\r\n}, {\r\n\ttimestamps: true\r\n})\r\n\r\n\r\nexport default mongoose.model('Shedule', SheduleSchema);","import testDefaultRoutes from '../resources/testDefaultRoutes';\r\nimport Shedule from '../models/shedule';\r\nimport checkId from '../middleware/checkId';\r\nimport passport from 'passport';\r\n\r\n\r\nconst params = {\r\n\tgetMiddlewares:[\r\n\t\t/*passport.authenticate('jwt', {session: false}),\r\n\t\t(req, res, next) => {\r\n\t\t\tif (req.user && req.user.login) {\r\n\t\t\t\treturn next();\r\n\t\t\t}\r\n\t\t\treturn res.json({success: false, msg: 'access denied'})\r\n\t\t}*/\r\n\t], //middlewares for 'get' request\r\n\tpostMiddlewares:[], //middlewares for 'post' request\r\n\tdeleteMiddlewares:[], //middlewares for 'delete' request\r\n\tputMiddlewares:[] //middlewares for 'put' request\r\n}\r\n\r\nconst defaultShedules = new testDefaultRoutes(params);\r\ndefaultShedules.init(Shedule, 'shedules');\r\n\r\n\r\n\r\n\r\n\r\n\r\n/*defaultShedules.router.get('', async(req, res, next) => {\r\n\ttry {\r\n\r\n\t} catch(err) {\r\n\t\tnetx(err);\r\n\t}\r\n})\r\n\r\ndefaultShedules.initPost(Shedule, 'shedules');\r\ndefaultShedules.initChange(Shedule, 'shedules');\r\ndefaultShedules.initDelete(Shedule, 'shedules');*/\r\n\r\nexport default defaultShedules.router;","import express from 'express';\r\nimport cors from 'cors';\r\nimport mongoose from 'mongoose';\r\nimport Promise from 'bluebird';\r\nimport path from 'path';\r\nimport passport from 'passport';\r\nimport config from './config/index';\r\nimport Passport from './config/passport';\r\nimport users from './routes/users';\r\nimport dishes from './routes/dishes';\r\nimport locations from './routes/locations';\r\nimport likes from './routes/likes';\r\nimport comments from './routes/comments';\r\nimport toppings from './routes/toppings';\r\nimport orders from './routes/orders';\r\nimport employees from './routes/employees';\r\nimport shedules from './routes/shedules';\r\nimport Topping from './models/topping';\r\n\r\n\r\n\r\nconst app = express();\r\nvar bodyParser = require('body-parser');\r\nPassport(passport);\r\n\r\napp.use(bodyParser.json());\r\napp.use(cors());\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\napp.use(express.static(path.join(__dirname, 'public'))); \r\napp.use('/static', express.static(path.join(__dirname, 'jenya')));\r\nconst port = 3000;\r\n\r\n\r\nmongoose.Promise = Promise;\r\n// Connect to Database\r\nmongoose.connect(config.database);\r\n// On connection\r\nmongoose.connection.on('connected', () => {\r\n\tconsole.log('connected to database ' + config.database);\r\n});\r\n// On Error\r\nmongoose.connection.on('error', (err) => {\r\n\tconsole.log('database error' + err);\r\n});\r\n\r\napp.get('/', (req, res) => {\r\n\tres.send('dratuti');\r\n});\r\n\r\napp.use('/users', users);\r\napp.use('/dishes', dishes);\r\napp.use('/locations', locations);\r\napp.use('/likes', likes);\r\napp.use('/comments', comments);\r\napp.use('/toppings', toppings);\r\napp.use('/orders', orders);\r\napp.use('/employees', employees);\r\napp.use('/shedules', shedules);\r\n\r\napp.use((req, res, next) => {\r\n\treturn res.status(404).json({msg: '404 Not Found'});\r\n})\r\n\r\napp.use((err, req, res, next) => {\r\n\tconsole.log(err);\r\n\treturn res.status(500).json({success: false, msg: err.name});\r\n})\r\n\r\n\r\n\r\napp.listen(port, () => {\r\n\tconsole.log('yep' + port);\r\n})"],"names":["mongoose","Promise","UserSchema","Schema","String","methods","toJSON","_","pick","pre","next","bcrypt","genSalt","then","hash","password","salt","catch","model","EmployeeSchema","JwtStrategy","require","Strategy","ExtractJwt","passport","jwtFromRequest","fromAuthHeader","secretOrKey","config","secret","use","opts","jwt_payload","done","login","Employee","findOne","phone","User","user","Passport","LikeSchema","Types","ObjectId","CommentSchema","Number","req","res","userAccess","employeeAccess","adminAccess","indexOf","originalUrl","role","status","json","success","msg","id","params","re","RegExp","match","defaultRoutes","router","express","Router","modelName","initGet","initPost","initChange","initDelete","get","authenticate","session","access","select","headers","modifiedSince","Date","parse","find","$gt","news","reduce","prev","candidate","updatedAt","lastModified","toLocaleString","set","send","userId","_id","findById","elem","post","body","save","modelNmae","checkId","update","$set","delete","remove","defaultUsers","exist","jwt","sign","expiresIn","token","log","name","compare","path","init","DishSchema","Boolean","arr","initPut","getMiddlewares","ifModifiedSince","changes","getLastModified","postMiddlewares","put","putMiddlewares","deleteMiddlewares","defaultDishes","testDefaultRoutes","Dish","LocationSchema","defaultLocations","Location","defaultLikes","Like","dishId","$isolated","$inc","newLike","defaultComments","Comment","ToppingSchema","defaultToppings","Topping","Array","keys","splice","Order","map","push","order","number","filter","value","usedNumbers","unique","OrderSchema","getUniqueNumber","defaultOrders","defaultEmployees","employee","daySchema","SheduleSchema","defaultShedules","Shedule","app","bodyParser","cors","initialize","static","join","__dirname","port","connect","database","connection","on","err","users","dishes","locations","likes","comments","toppings","orders","employees","shedules","listen"],"mappings":"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"}