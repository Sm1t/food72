{"version":3,"file":"index.js","sources":["../src/config/index.js","../src/models/user.js","../src/models/employee.js","../src/config/passport.js","../src/models/like.js","../src/models/comment.js","../src/middleware/access.js","../src/resources/defaultRoutes.js","../src/routes/users.js","../src/models/dish.js","../src/routes/dishes.js","../src/models/location.js","../src/routes/locations.js","../src/routes/likes.js","../src/routes/comments.js","../src/models/topping.js","../src/routes/toppings.js","../src/models/order.js","../src/routes/orders.js","../src/routes/employees.js","../src/index.js"],"sourcesContent":["export default {\r\n\tdatabase: 'mongodb://sm1t:34ezezin@ds145299.mlab.com:45299/food72',\r\n\tsecret: 'yoursecret'\r\n}","import mongoose from 'mongoose';\r\nimport bcrypt from 'bcryptjs';\r\nimport Promise from 'bluebird';\r\nimport _ from 'lodash';\r\nmongoose.Promise = Promise;\r\n\r\nconst UserSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tphone: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\temail: {\r\n\t\ttype: String\r\n\t},\r\n\tavatar: {\r\n\t\ttype: String,\r\n\t\tdefault: ''\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\n\r\nUserSchema.methods.toJSON = function() {\r\n\treturn _.pick(this, ['_id', 'name', 'phone', 'email', 'avatar']);\r\n}\r\n\r\nexport default mongoose.model('User', UserSchema);\r\n\r\n\r\n","import mongoose from 'mongoose';\r\nimport _ from 'lodash';\r\n\r\nconst EmployeeSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tsurname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tposition: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tlogin: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\trole: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\tdefault: 'employee'\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\n\r\nEmployeeSchema.methods.toJSON = function() {\r\n\treturn _.pick(this, ['_id', 'name', 'surname', 'position']);\r\n}\r\n\r\nexport default mongoose.model('Employee', EmployeeSchema);\r\n\r\n\r\n","const JwtStrategy = require('passport-jwt').Strategy;\r\nconst ExtractJwt = require('passport-jwt').ExtractJwt;\r\nimport User from '../models/user';\r\nimport Employee from '../models/employee';\r\nimport config from '../config/index';\r\n\r\nexport default async function Passport(passport){\r\n\tlet opts = {};\r\n\topts.jwtFromRequest = ExtractJwt.fromAuthHeader();\r\n\topts.secretOrKey = config.secret;\r\n\tpassport.use(new JwtStrategy(opts, async (jwt_payload, done) => {\r\n\t\ttry {\r\n\t\t\tif (jwt_payload.login) {\r\n\t\t\t\tvar user = await Employee.findOne({login: jwt_payload.login});\r\n\t\t\t}\r\n\t\t\tif (jwt_payload.phone) {\r\n\t\t\t\tvar user = await User.findOne({phone: jwt_payload.phone});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//console.log(user);\r\n\t\t\tif (user) {\r\n\t\t\t\treturn done(null, user);\r\n\t\t\t} else done(null, false);\r\n\t\t} catch(err) {\r\n\t\t\treturn done(err, false);\r\n\t\t}\r\n\t}))\r\n}","import mongoose from 'mongoose';\r\nconst { Schema } = mongoose;\r\n\r\nconst LikeSchema = mongoose.Schema({\r\n\tdishId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'Dish',\r\n\t\trequired: true\r\n\t},\r\n\tuserId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'User',\r\n\t\trequired: true\r\n\t}\r\n});\r\n\r\nexport default mongoose.model('Like', LikeSchema);\r\n\r\n","import mongoose from 'mongoose';\r\nimport { Schema } from 'mongoose';\r\n\r\nconst CommentSchema = mongoose.Schema({\r\n\tdish: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'Dish',\r\n\t\trequired: true\r\n\t},\r\n\tuserId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'User',\r\n\t\trequired: true\r\n\t},\r\n\ttext: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\trating: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n})\r\n\r\nexport default mongoose.model('Comment', CommentSchema);","export default (req, res, next) => {\r\n\tconst userAccess = ['/likes', '/comments', '/orders'];\r\n\tconst employeeAccess = ['/dishes', '/toppings', '/locations'];\r\n\tconst adminAccess = ['/employees'];\r\n\r\n\tif (req.user) {\r\n\t\tif (adminAccess.indexOf(req.originalUrl) != -1) {\r\n\t\t\tif (req.user.role === 'admin') return next();\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Access denied'});\r\n\t\t}\r\n\r\n\t\tif (employeeAccess.indexOf(req.originalUrl) != -1) {\r\n\t\t\tif (req.user.login) return next();\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Access denied'});;\r\n\t\t}\r\n\r\n\t\tif (userAccess.indexOf(req.originalUrl) != -1) {\r\n\t\t\tif (req.user.phone) return next();\r\n\t\t\treturn res.status(401).json({success: false, msg: 'Unauthorized'});;\r\n\t\t}\r\n\t}\r\n\r\n\treturn res.status(403).json({success: false, msg: 'Access denied'});\r\n}","import express from 'express';\r\nimport passport from 'passport';\r\nimport access from '../middleware/access';\r\n\r\nexport default class defaultRoutes {\r\n\tconstructor() {\r\n\t\tthis.router = express.Router();\r\n\t}\r\n\r\n\tinit(model, modelName) {\r\n\t\tthis.initGet(model, modelName);\r\n\t\tthis.initPost(model, modelName);\r\n\t\tthis.initChange(model, modelName);\r\n\t\tthis.initDelete(model, modelName);\r\n\t}\r\n\t\r\n\tinitGet(model, modelName) {\r\n\t\tthis.router.get('/:id?/:select?', async(req, res) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\tconst select = req.params.select;\r\n\r\n\t\t\tif (!id && !select) {\r\n\t\t\t\tlet modifiedSince = req.headers['if-modified-since'];\r\n\t\t\t\tif (modifiedSince) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tmodifiedSince = new Date(Date.parse(modifiedSince));\r\n\t\t\t\t\t\tlet news = await model.find({\"updatedAt\": {$gt: modifiedSince}});\r\n\t\t\t\t\t\tif (news[0]) {\r\n\t\t\t\t\t\t\tlet lastModified = news.reduce(function(prev, candidate) {\r\n\t\t\t\t\t\t\t\treturn (prev.updatedAt > candidate.updatedAt) ? prev : candidate;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tlastModified = Date.parse(lastModified.updatedAt);\r\n\t\t\t\t\t\t\tconst opts = {\r\n\t\t\t\t\t\t\t\tyear: 'numeric',\r\n\t\t\t\t\t\t\t\tmonth: 'short',\r\n\t\t\t\t\t\t\t\tday: 'numeric',\r\n\t\t\t\t\t\t\t\tweekday: 'short',\r\n\t\t\t\t\t\t\t\thour: 'numeric',\r\n\t\t\t\t\t\t\t\tminute: 'numeric',\r\n\t\t\t\t\t\t\t\tsecond: 'numeric',\r\n\t\t\t\t\t\t\t\ttimeZoneName: 'short',\r\n\t\t\t\t\t\t\t\thour12: false\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tlastModified = (new Date(lastModified)).toLocaleString('en-US', opts);\r\n\t\t\t\t\t\t\tres.set('Last-Modified', lastModified);\r\n\t\t\t\t\t\t\treturn res.json(news);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn res.status(304).send();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(err) {\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\treturn res.status(500).json({success: false, msg: err.name});\t\r\n\t\t\t\t\t}\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn res.json(await model.find());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst re = new RegExp('(^[0-9a-fA-F]{24}$)');\r\n\t\t\tif (!id.match(re)) {\r\n\t\t\t\treturn res.status(400).json({success: false, msg: `Incorrect ${modelName} id`})\r\n\t\t\t}\r\n\r\n\t\t\tif (id && !select) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\t\tif (!elem) return res.status(404).json({success: false, msg: `${modelName} not found`})\r\n\t\t\t\t\treturn res.json(elem);\r\n\t\t\t\t} catch(err) {\r\n\t\t\t\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem[`${select}`]) return res.json({success: false, msg: `Cannot select ${select}`});\r\n\t\t\t\treturn res.json(elem[`${select}`]);\r\n\t\t\t} catch(err) {\r\n\t\t\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitPost(model, modelName) {\r\n\t\tthis.router.post('', passport.authenticate('jwt', {session: false}), access, async(req, res) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\ttry {\r\n\t\t\t\t/*if (['orders', 'likes', 'comments'].indexOf(modelName) != -1) {\r\n\t\t\t\t\tvar elem = new model(Object.assign({}, req.body, {userId: req.user.id}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar elem = new model(req.body);\r\n\t\t\t\t}*/\r\n\t\t\t\tconst elem = new model(req.body);\r\n\t\t\t\t\r\n\t\t\t\tawait elem.save();\r\n\t\t\t\treturn res.status(201).json(elem);\r\n\t\t\t} catch(err) {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t\treturn res.status(500).json({success: false, msg: err.name});\t\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitChange(model, modelNmae) {\r\n\t\tthis.router.post('/:id', passport.authenticate('jwt', {session: false}), access, async(req, res) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\tconst re = new RegExp('(^[0-9a-fA-F]{24}$)');\r\n\t\t\tif (!id.match(re)) {\r\n\t\t\t\treturn res.status(400).json({success: false, msg: `Incorrect ${modelName} id`});\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem) return res.status(404).json({success:false, msg: `${modelName} not found`});\r\n\t\t\t\tawait model.update({_id: id}, {$set:\r\n\t\t\t\t\treq.body\r\n\t\t\t\t});\r\n\t\t\t\treturn res.json({success: true, msg: `${modelName} updated`});\r\n\t\t\t} catch(err) {\r\n\t\t\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tinitDelete(model, modelName) {\r\n\t\tthis.router.post('/:id', passport.authenticate('jwt', {session: false}), access, async(req, res) => {\r\n\t\t\tconst id = req.params.id;\r\n\t\t\tconst re = new RegExp('(^[0-9a-fA-F]{24}$)');\r\n\t\t\tif (!id.match(re)) {\r\n\t\t\t\treturn res.status(400).json({success: false, msg: `Incorrect ${modelName} id`});\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst elem = await model.findById(id);\r\n\t\t\t\tif (!elem) return res.status(404).json({success:false, msg: `${modelName} not found`});\r\n\t\t\t\tawait elem.remove();\r\n\t\t\t\treturn res.json({success: true, msg: `${modelName} deleted`});\r\n\t\t\t} catch(err) {\r\n\t\t\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n\r\n","import passport from 'passport';\r\nimport jwt from 'jsonwebtoken';\r\nimport config from '../config/index';\r\nimport bcrypt from 'bcryptjs';\r\nimport User from '../models/user';\r\nimport Like from '../models/like';\r\nimport Comment from '../models/comment';\r\nimport defaultRoutes from '../resources/defaultRoutes';\r\n\r\nconst defaultUsers = new defaultRoutes();\r\n\r\n// Register\r\ndefaultUsers.router.post('', async(req, res) => {\r\n\tconst exist = await User.findOne({phone: req.body.phone});;\r\n\tif (exist) return res.status(400).json({success: false, msg: 'User already exist'});\r\n\r\n\ttry {\r\n\t\tconst user = new User(req.body),\r\n\t\t\t  phone = user.phone,\r\n\t\t\t  salt = await bcrypt.genSalt(10),\r\n\t\t \t  hash = await bcrypt.hash(user.password, salt);\r\n\t\tuser.password = hash;\r\n\t\tuser.save();\r\n\t\tconst token = jwt.sign({phone}, config.secret, {expiresIn: 604800});\r\n\t\treturn res.status(201).json(Object.assign({}, user.toJSON(), {token: 'JWT ' + token}));\r\n\t} catch(err) {\r\n\t\tconsole.log(err);\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n});\r\n\r\n// Authenticate\r\ndefaultUsers.router.post('/authenticate', async(req, res) => {\r\n\tconst phone = req.body.phone,\r\n\t\t  password = req.body.password;\r\n\r\n\tconst user = await User.findOne({phone: phone});\r\n\tif (!user) return res.status(404).json({success: false, msg: \"User not found\"});\r\n\r\n\ttry {\r\n\t\tif (await bcrypt.compare(password, user.password)) {\r\n\t\t\tconst token = jwt.sign({phone}, config.secret, {expiresIn: 604800});\r\n\t\t\treturn res.json(Object.assign({}, user.toJSON(), {token: 'JWT ' + token}));\r\n\t\t} else {\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Wrong password'});\r\n\t\t}\r\n\t} catch(err) {\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n})\r\n\r\ndefaultUsers.router.post('/profile', passport.authenticate('jwt', {session: false}), async (req, res) => {\r\n\tres.json(['/dishes', 'toppings', '/locations'].indexOf(req.path));\r\n})\r\n\r\ndefaultUsers.init(User, 'user');\r\n\r\nexport default defaultUsers.router;\r\n\r\n","import mongoose from 'mongoose';\r\nimport Like from './like';\r\nimport { Schema } from 'mongoose';\r\nimport _ from 'lodash';\r\n\r\n// Product Schema\r\nconst DishSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tcategory : {\r\n\t\ttype: String\r\n\t},\r\n\tlocations: [\r\n\t\t{\r\n\t\t\tlocationId: {\r\n\t\t\t\ttype: Schema.Types.ObjectId,\r\n\t\t\t\tref: 'Location',\r\n\t\t\t\trequired: true\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\ttoppings: [\r\n\t\t{\r\n\t\t\ttoppingId: {\r\n\t\t\t\ttype: Schema.Types.ObjectId,\r\n\t\t\t\tref: 'Topping',\r\n\t\t\t\trequired: true\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tdishPicture: {\r\n\t\ttype: String\r\n\t},\r\n\tcallories: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tdescription: {\r\n\t\ttype: String\r\n\t},\r\n\tcomposition: [\r\n\t\t{\r\n\t\t\tname: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true\r\n\t\t\t},\r\n\t\t\tquantity: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tweight: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tconteiner: {\r\n\t\ttype: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\tsize: {\r\n\t\t\ttype: Number,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\tprice: {\r\n\t\t\ttype: Number,\r\n\t\t\trequired: true\r\n\t\t}\r\n\t},\r\n\tproteins: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tcarbohydrates: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tfats: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tprice: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\trating: {\r\n\t\ttype: Number,\r\n\t\tdefault: 5\r\n\t},\r\n\tlikesCount: {\r\n\t\ttype: Number,\r\n\t\trequired: true,\r\n\t\tdefault: 0\r\n\t},\r\n\tactive: {\r\n\t\ttype: Boolean,\r\n\t\tdefault: true,\r\n\t\trequired: true\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\nexport default mongoose.model('Dish', DishSchema);\r\n","import Dish from '../models/dish';\r\nimport defaultRoutes from '../resources/defaultRoutes';\r\n\r\nconst defaultDishes = new defaultRoutes();\r\n\r\ndefaultDishes.router.get('', async (req, res, next) => {\r\n\tconst location = req.query.location;\r\n\tif (location) {\r\n\t\treturn res.json(await Dish.find({ \"locations.locationId\": location }));\r\n\t} else next();\r\n})\r\n\r\ndefaultDishes.init(Dish, 'dishes');\r\n\r\nexport default defaultDishes.router;","import mongoose from 'mongoose';\r\n\r\nconst LocationSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tnumber: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t}\r\n})\r\n\r\nexport default mongoose.model('Location', LocationSchema);","import defaultRoutes from '../resources/defaultRoutes';\r\nimport Location from '../models/location';\r\n\r\n\r\nconst defaultLocations = new defaultRoutes();\r\ndefaultLocations.init(Location, 'locations');\r\n\r\nexport default defaultLocations.router;","import defaultRoutes from '../resources/defaultRoutes';\r\nimport Like from '../models/like';\r\nimport Dish from '../models/dish';\r\n\r\nconst defaultLikes = new defaultRoutes();\r\n\r\ndefaultLikes.router.post('', async(req, res) => {\r\n\ttry {\r\n\t\tconst elem = new Like(req.body);\r\n\t\tawait elem.save();\r\n\t\tconst test = await Dish.find({_id: elem.dishId});\r\n\t\tconsole.log(test);\r\n\t\treturn res.status(201).json(elem);\r\n\t} catch(err) {\r\n\t\tconsole.log(err);\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n})\r\n\r\ndefaultLikes.init(Like, 'likes');\r\n\r\nexport default defaultLikes.router;\r\n","import defaultRoutes from '../resources/defaultRoutes';\r\nimport Comment from '../models/comment';\r\n\r\nconst defaultComments = new defaultRoutes();\r\ndefaultComments.init(Comment, 'comments');\r\n\r\nexport default defaultComments.router;","import mongoose from 'mongoose';\r\nimport { Schema } from 'mongoose';\r\n\r\nconst ToppingSchema = mongoose.Schema({\r\n\tname: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tprice: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\tweight: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t}\r\n})\r\n\r\nexport default mongoose.model('Topping', ToppingSchema);","import defaultRoutes from '../resources/defaultRoutes';\r\nimport Topping from '../models/topping';\r\n\r\nconst defaultToppings = new defaultRoutes();\r\ndefaultToppings.init(Topping, 'toppings');\r\n\r\nexport default defaultToppings.router;","import mongoose from 'mongoose';\r\nconst { Schema } = mongoose;\r\n\r\nconst OrderSchema = mongoose.Schema({\r\n\tuserId: {\r\n\t\ttype: Schema.Types.ObjectId,\r\n\t\tref: 'User',\r\n\t\trequired: true\r\n\t},\r\n\tdishes: [\r\n\t\t{\r\n\t\t\tdishId: {\r\n\t\t\t\ttype: Schema.Types.ObjectId,\r\n\t\t\t\tref: 'Dish',\r\n\t\t\t\trequired: true\r\n\t\t\t},\r\n\t\t\tquantity: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\trequired: true,\r\n\t\t\t\tdefault: 1\r\n\t\t\t}\r\n\t\t}\r\n\t],\r\n\tpayStatus: {\r\n\t\ttype: Boolean,\r\n\t\trequired: true,\r\n\t\tdefault: false\r\n\t},\r\n\tcompleted: {\r\n\t\ttype: Boolean,\r\n\t\trequired: true,\r\n\t\tdefault: false\r\n\t},\r\n\tstatus: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\tdefault: 'Обратывается'\r\n\t},\r\n\ttotalPrice: {\r\n\t\ttype: Number,\r\n\t\trequired: true\r\n\t},\r\n\ttime: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t}\r\n}, {\r\n\ttimestamps: true\r\n});\r\n\r\nexport default mongoose.model('Order', OrderSchema);","import defaultRoutes from '../resources/defaultRoutes';\r\nimport Order from '../models/order';\r\n\r\nconst defaultOrders = new defaultRoutes();\r\ndefaultOrders.init(Order, 'orders');\r\n\r\nexport default defaultOrders.router;","import passport from 'passport';\r\nimport defaultRoutes from '../resources/defaultRoutes';\r\nimport Employee from '../models/employee';\r\nimport bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\nimport config from '../config/index';\r\n\r\nconst defaultEmployees = new defaultRoutes();\r\n\r\n// Register\r\ndefaultEmployees.router.post('', async(req, res) => {\r\n\tconst exist = await Employee.findOne({login: req.body.login});;\r\n\tif (exist) return res.status(400).json({success: false, msg: 'Employee already exist'});\r\n\r\n\ttry {\r\n\t\tconst employee = new Employee(req.body),\r\n\t\t\t  login = employee.login,\r\n\t\t\t  salt = await bcrypt.genSalt(10),\r\n\t\t \t  hash = await bcrypt.hash(employee.password, salt);\r\n\t\temployee.password = hash;\r\n\t\temployee.save();\r\n\t\tconst token = jwt.sign({login}, config.secret, {expiresIn: 604800});\r\n\t\treturn res.status(201).json(Object.assign({}, employee.toJSON(), {token: 'JWT ' + token}));\r\n\t} catch(err) {\r\n\t\tconsole.log(err);\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n});\r\n\r\n// Authenticate\r\ndefaultEmployees.router.post('/login', async(req, res) => {\r\n\tconst login = req.body.login,\r\n\t\t  password = req.body.password;\r\n\r\n\tconst employee = await Employee.findOne({login: login});\r\n\tif (!employee) return res.status(404).json({success: false, msg: \"Employee not found\"});\r\n\r\n\ttry {\r\n\t\tif (await bcrypt.compare(password, employee.password)) {\r\n\t\t\tconst token = jwt.sign({login}, config.secret, {expiresIn: 604800});\r\n\t\t\treturn res.json(Object.assign({}, employee.toJSON(), {token: 'JWT ' + token}));\r\n\t\t} else {\r\n\t\t\treturn res.status(403).json({success: false, msg: 'Wrong password'});\r\n\t\t}\r\n\t} catch(err) {\r\n\t\treturn res.status(500).json({success: false, msg: err.name});\r\n\t}\r\n})\r\n\r\ndefaultEmployees.router.post('/profile', passport.authenticate('jwt', {session: false}), async (req, res) => {\r\n\tres.json(req.user);\r\n})\r\n\r\n\r\ndefaultEmployees.init(Employee, 'employees');\r\n\r\nexport default defaultEmployees.router;","import express from 'express';\r\nimport cors from 'cors';\r\nimport mongoose from 'mongoose';\r\nimport Promise from 'bluebird';\r\nimport path from 'path';\r\nimport passport from 'passport';\r\nimport config from './config/index';\r\nimport Passport from './config/passport';\r\nimport users from './routes/users';\r\nimport dishes from './routes/dishes';\r\nimport locations from './routes/locations';\r\nimport likes from './routes/likes';\r\nimport comments from './routes/comments';\r\nimport toppings from './routes/toppings';\r\nimport orders from './routes/orders';\r\nimport employees from './routes/employees';\r\n\r\n\r\n\r\nconst app = express();\r\nvar bodyParser = require('body-parser');\r\nPassport(passport);\r\n\r\napp.use(bodyParser.json());\r\napp.use(cors());\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\napp.use(express.static(path.join(__dirname, 'public'))); \r\napp.use('/static', express.static(path.join(__dirname, 'jenya')));\r\nconst port = 3000;\r\n\r\n\r\nmongoose.Promise = Promise;\r\n// Connect to Database\r\nmongoose.connect(config.database);\r\n// On connection\r\nmongoose.connection.on('connected', () => {\r\n\tconsole.log('connected to database ' + config.database);\r\n});\r\n// On Error\r\nmongoose.connection.on('error', (err) => {\r\n\tconsole.log('database error' + err);\r\n});\r\n\r\n\r\napp.use('/users', users);\r\napp.use('/dishes', dishes);\r\napp.use('/locations', locations);\r\napp.use('/likes', likes);\r\napp.use('/comments', comments);\r\napp.use('/toppings', toppings);\r\napp.use('/orders', orders);\r\napp.use('/employees', employees);\r\n\r\n\r\napp.get('/', (req, res) => {\r\n\tres.send('dratuti');\r\n})\r\n\r\napp.listen(port, () => {\r\n\tconsole.log('yep' + port);\r\n})"],"names":["mongoose","Promise","UserSchema","Schema","String","methods","toJSON","_","pick","model","EmployeeSchema","JwtStrategy","require","Strategy","ExtractJwt","passport","jwtFromRequest","fromAuthHeader","secretOrKey","config","secret","use","opts","jwt_payload","done","login","Employee","findOne","phone","User","user","Passport","LikeSchema","Types","ObjectId","CommentSchema","Number","req","res","next","userAccess","employeeAccess","adminAccess","indexOf","originalUrl","role","status","json","success","msg","defaultRoutes","router","express","Router","modelName","initGet","initPost","initChange","initDelete","get","params","id","select","headers","modifiedSince","Date","parse","find","$gt","news","reduce","prev","candidate","updatedAt","lastModified","toLocaleString","set","send","log","name","RegExp","match","re","findById","elem","post","authenticate","session","access","body","save","modelNmae","update","_id","$set","remove","defaultUsers","exist","bcrypt","genSalt","hash","password","salt","jwt","sign","expiresIn","token","compare","path","init","DishSchema","Boolean","defaultDishes","query","location","Dish","LocationSchema","defaultLocations","Location","defaultLikes","Like","dishId","test","defaultComments","Comment","ToppingSchema","defaultToppings","Topping","OrderSchema","defaultOrders","Order","defaultEmployees","employee","app","bodyParser","cors","initialize","static","join","__dirname","port","connect","database","connection","on","err","users","dishes","locations","likes","comments","toppings","orders","employees","listen"],"mappings":"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"}